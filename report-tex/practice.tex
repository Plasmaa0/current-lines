\chapter{Практическая часть}
\section{Задание}\label{задание}
Реализовать построение линий тока для заданного двухмерного векторного поля на четырехугольной, треугольной и гибридной сетке.
\input{msh_format}
\section{Реализация на языке программирования C++}
\subsection{Ход работы алгоритма}
Программа реализовывает метод, описанный в разделе \ref{method}.
\begin{enumerate}
	\item Считать файл в формате \verb|.msh|, сформировать массив вершин, КЭ, записать координаты и значения векторного поля;
	\item Выполнить алгоритм, описанный в разделе \ref{method};
	\item Вывести полученную линию тока $L$ в формате \verb|.geo| (см. раздел \ref{geo_format} \nameref{geo_format})
\end{enumerate}

Опустим обзор реализации таких примитивов как точка (вершина), координаты, прямая, векторное поле, а также прочих вспомогательных функций и объектов, поскольку их принцип работы тривиален. Также опустим реализацию считывания данных из формата \verb|.msh| и их вывод в формате \verb|.geo|, так как она представляет собой просто считывание и печать в файлы в строгом соотвествии с форматом.

Рассмотрим подробнее основную часть алгоритма, а именно реализацию функций $I, E, A$ (см. раздел \ref{method}):
\begin{itemize}
	\item $I$ --- индикатор, проверка нахождения точки в заданном КЭ;
	\item $E$ --- определение текущего элемента по текущей точке;
	\item $A$ --- интерполяция значений векторного поля в вершинах КЭ для текущей точки.
\end{itemize}
\subsection{Определение положения точки относительно конечного элемента}
Рассмотрим методы решения задачи о принадлежности точки выпуклому многоугольнику.
\input{method_cross_product}
\input{method_ray_trace}
%\input{node_sorting}

\subsection{Интерполяция в КЭ}
\input{quad_interpolation}
\input{trig_interpolation}
\subsection{Результаты генерации линий тока на разных типах сеток}
В процессе создания программы были реализованы следующие алгоритмы:
\begin{itemize}
	\item[---] Определение положения точки относительно КЭ:
	\begin{enumerate}[label=\arabic*)]
		\item метод на основе вычисления векторных произведений (для любых двумерных сеток),
		\item метод трассировки лучей (для любых двумерных сеток).
	\end{enumerate}
	\item[---] Сортировка вершин КЭ:
	\begin{enumerate}[label=\arabic*)]
		\item метод \verb|atan2| (не используется ввиду неэффективности),
		\item метод на основе вычисления векторных произведений.
	\end{enumerate}
	\item[---] Интерполяция значений в КЭ:
	\begin{enumerate}[label=\arabic*)]
		\item билинейная интерполяция (для четырехугольных КЭ),
		\item наивная интерполяция на основе вычисления расстояния до вершин (для любых КЭ),
		\item метод на основе барицентрических координат (для треугольных КЭ).
	\end{enumerate}
\end{itemize}

\section{Выходные данные. Формат .geo}\label{geo_format}
Для визуализации линий тока была выбрана программа \verb|gmsh|. Она позволяет интерактивно работать с моделями, сетками и другими видами геометрии, заданными в различных форматах. Удобным способом задания линий тока, который поддерживается программой \verb|gmsh|, является формат \verb|.geo|. Это очень обширный формат, позволяющий описывать сложную геометрию, полностью рассматривать его не будем. Опишем только способ задания линий тока в данном формате:
\begin{verbatim}
	Point(1) = {0.1, 0.05, 0, 1.2};
	Point(2) = {0.111707, 0.0526363, 0, 1.2};
	Point(3) = {0.123414, 0.0552719, 0, 1.2};
	Point(4) = {0.135121, 0.0579057, 0, 1.2};
	...
	Point(97) = {1.17998, 0.397062, 0, 1.2};
	Point(98) = {1.19178, 0.399233, 0, 1.2};
	Line(98) = {1, 2, 3, 4, ..., 97, 98};
\end{verbatim}
Построчно выводятся полученные точки с их номерами и тегами (необходимы для правильной визуализации) в следующем формате:
\begin{verbatim}
	Point(<номер точки>) = {<x>, <y>, <z>, <тег>};
\end{verbatim}
После задания точек выводится строка (или строки) с информацией о линии (линиях), построенных на данных точках. Строка, описывающая линию, имее следующий формат:
\begin{verbatim}
	Line(<количество точек>) = {<список номеров точек>};
\end{verbatim}

В итоге результаты работы можно увидеть выполнив команду:
\begin{verbatim}
	gmsh model.msh result.geo
\end{verbatim}
Тогда программа визуализации \verb|gmsh| отобразит исходную конечно-элементную сетку, векторное поле, заданное в её узлах, а также полученную линию тока.

Полный код программы доступен по ссылке \url{https://github.com/Plasmaa0/current-lines}.